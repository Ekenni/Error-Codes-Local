<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Error Codes Viewer</title>
    <!-- XLSX library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .search-input,
      .filter-dropdown {
        margin: 10px 5px;
        padding: 5px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <h1>Error Codes Viewer</h1>
    <input type="file" id="fileInput" accept=".xlsx,.xls" />
    <br />
    <input
      type="text"
      id="searchInput"
      class="search-input"
      placeholder="Search error code..."
    />

    <label for="categorySelect">Category:</label>
    <select id="categorySelect" class="filter-dropdown">
      <option value="All">All categories</option>
      <option>Engine</option>
      <option>Transmission</option>
      <option>Armrest</option>
      <option>TMF</option>
      <option>ICU/Instrument</option>
      <option>ATC</option>
      <option>EDC/Hitch</option>
      <option>EHR/AUX</option>
      <option>Rear PTO</option>
      <option>FWD/DIFF</option>
      <option>Front PTO</option>
      <option>Front Suspension</option>
      <option>DCU</option>
      <option>EPL</option>
      <option>FEHR</option>
      <option>Front Hitch</option>
      <option>ADIC/ICU2</option>
      <option>Steering Controller</option>
      <option>PERF</option>
      <option>Fast Steer</option>
      <option>Calibration U Codes</option>
      <option>ABS</option>
      <option>UCM</option>
    </select>

    <table
      style="
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      "
      id="errorTable"
    >
      <thead>
        <tr>
          <th>Error</th>
          <th>Category</th>
          <th>Description</th>
          <th>Model</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      let codes = [];

      // Handle file upload
      document
        .getElementById("fileInput")
        .addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            codes = XLSX.utils.sheet_to_json(worksheet);

            applyFilters();
          };
          reader.readAsArrayBuffer(file);
        });

      // Handle search
      document
        .getElementById("searchInput")
        .addEventListener("input", applyFilters);

      // Handle category filter
      document
        .getElementById("categorySelect")
        .addEventListener("change", applyFilters);

      // Apply filters
      function applyFilters() {
        const term = document.getElementById("searchInput").value.toLowerCase();
        const category = document.getElementById("categorySelect").value;

        const filtered = codes.filter((code) => {
          const matchesSearch =
            String(code.error).toLowerCase().includes(term) ||
            String(code.category).toLowerCase().includes(term) ||
            String(code.description).toLowerCase().includes(term) ||
            String(code.model).toLowerCase().includes(term);

          const matchesCategory =
            category === "All" ||
            String(code.category).toLowerCase() === category.toLowerCase();

          return matchesSearch && matchesCategory;
        });

        renderTable(filtered);
      }

      // Render table
      function renderTable(data) {
        const tbody = document.querySelector("#errorTable tbody");
        tbody.innerHTML = "";
        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:red">No results found</td></tr>`;
          return;
        }
        data.forEach((code) => {
          const row = `<tr>
          <td>${code.error || ""}</td>
          <td>${code.category || ""}</td>
          <td>${code.description || ""}</td>
          <td>${code.model || ""}</td>
        </tr>`;
          tbody.innerHTML += row;
        });
      }
    </script>
  </body>
</html>
